<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Effects of Twitter Hype on Financial Markets</title>
        <script type="text/javascript" src="lib/d3.v5.min.js"></script>
        <style type = "text/css">

            text {
                font-family: candara;
            }

            rect {
                fill: #fff7bc
            }

            .line{
                fill: none
            }
            div {
            }


        </style>
    </head>
    <body>
        <script type="text/javascript">

            var w = 1400;
            var h = 500;
            var wPadding = 60;
            var hPadding = 40;
            var parseTime = d3.timeParse("%Y-%m-%d %H:%M:%S%Z");
            var parseTime2 = d3.timeParse("%m/%d/%Y")


            d3.select("body")
              .append("svg")
              .attr("width", w)
              .attr("height", 30)
              .attr("font-size", 30)
              .append("text")
              .attr("x", w/2-70)
              .attr("y", 22)
              .text("Analyzing the Effect of Twitter Hype on Financial Markets")
              .attr("text-anchor", "middle");



            d3.dsv(",", "finance_data.csv", function (d) {
                return {
                    datetime: parseTime(d.Datetime),
                    TSLA_price: parseFloat(d.TSLA_price),
                    ZM_price: parseFloat(d.ZM_price),
                    AMZN_price: parseFloat(d.AMZN_price),
                    DAL_price: parseFloat(d.DAL_price),
                    NFLX_price: parseFloat(d.NFLX_price),
                    NVS_price: parseFloat(d.NVS_price),
                    PFE_price: parseFloat(d.PFE_price),
                    TRIP_price: parseFloat(d.TRIP_price),
                    GOOGL_price: parseFloat(d.GOOGL_price)
                }
            } ).then(function(data) {
                d3.dsv(",", "hype-day-2.csv", function (d) {
                    return {
                        datetime: parseTime2(d.datetime),
                        tesla_hype: parseFloat(d.tesla_hype),
                        zm_hype: parseFloat(d.zoom_hype),
                        amazon_hype: parseFloat(d.amazon_hype),
                        delta_hype: parseFloat(d.delta_hype),
                        google_hype: parseFloat(d.google_hype),
                        netflix_hype: parseFloat(d.netflix_hype),
                        novartis_hype: parseFloat(d.novartis_hype),
                        pfizer_hype: parseFloat(d.pfizer_hype),
                        tripadvisor_hype: parseFloat(d.tripadvisor_hype)
                    }
                }).then(function (data2) {

                    var factor = Math.floor(0.01*data.length)
                    var circles = []
                    for (var x = 0; x <= 100; x++) {
                        circles.push(data[x*factor])
                    }
                    var minDate = d3.min(data, function(d) { return d.datetime});
                    var maxDate = d3.max(data, function(d) { return d.datetime});
                    var min = d3.min(data, function(d) {return d.TSLA_price})
                    var max = d3.max(data, function(d) {return d.TSLA_price})
                    var min2 = d3.min(data2, function(d) {return d.tesla_hype})
                    var max2 = d3.max(data2, function(d) {return d.tesla_hype})
                    var xScale = d3.scaleTime()
                                    .domain([minDate,maxDate])
                                    .range([wPadding*2, w-wPadding*4])

                    var xAxis = d3.axisBottom()
                                  .scale(xScale)
                                  .tickValues(d3.timeDay.range(minDate, maxDate, 1))
                                  .tickFormat(d3.timeFormat("%m/%d"));

                    var yScale = d3.scaleLinear()
                                   .domain([min*0.95,(max*1.05)])
                                   .range([h-hPadding, hPadding]);

                    var yScale2 = d3.scaleLinear()
                                    .domain([0,max2*1.05])
                                    .range([h-hPadding,hPadding]);

                    var yAxis = d3.axisLeft()
                                  .scale(yScale)
                                  .ticks(10);

                    var yAxis2 = d3.axisRight()
                                   .scale(yScale2)
                                   .ticks(10)


                    var selectContainer = d3.select("body")
                                            .append("div")
                                            .attr("width", 40)
                                            .attr("height", 20);

                    selectContainer.append("text")
                                   .text("Select a stock: ")
                                   .attr("class", "text")
                                   .attr("font-size", "12px");

                    selectContainer.append("select")
                                   .selectAll("option")
                                   .data(["Tesla (TSLA)", "Zoom (ZM)", "Amazon (AMZN)", "Delta (DAL)", "Google (GOOGL)", "Netflix (NFLX)", "Novartis (NVS)", "Pfizer (PFE)", "Trip Advisor (TRIP)"])
                                   .enter()
                                   .append("option")
                                   .attr("class","text")
                                   .text(function(d) {return d;})
                                   .attr("value", function(d,i) {return i;});

                    selectContainer.select("select")
                                   .on("change", function(d) {
                                       updateChart(d3.select(this).property("value"));
                                   });

                    var svg = d3.select("body")
                                .append("svg")
                                .attr("width", w)
                                .attr("height", h+400)
                                .attr("x", 0)
                                .attr("y", 0)
                                .style("background-color", "white");

                    var svg2 = svg.append("g")
                                  .attr("class", "svg 2")
                                  .attr("transform", "translate(" + (w/2-300) + ", " + (h + 10) + " )");

                    var info = svg.append("g")
                                  .attr("class", "svg 2")
                                  .attr("transform", "translate(" + (120) + ", " + (h + 150) + " )");

                    info.append("text")
                        .text("Welcome! Our website allows you to examine the effects of a stock's hype on twitter versus its stock price.");

                    info.append("text")
                        .attr("y", 18)
                        .text("Select a stock to examine in the drop down menu.");

                    info.append("text")
                        .attr("y", 36)
                        .text("Hover over the circles to view stock data at that point, and hover over the rectangles to view the hype data for that day.")

                    info.append("text")
                        .attr("y", 54)
                        .text("Visualize how the stock data (line) is affected by the hype (rectangles).")

                    info.append("text")
                        .attr("y", 72)
                        .text(" \"0\" or \"negative\" hype will be represented by small bars under the x axis.")

                    info.append("text")
                        .attr("y", 150)
                        .attr("font-size", 12)
                        .text("CX4242, Pietro Dominetto, Austin Fan, Katie Jooyoung Kim")

                     // Initial bars of hype bar chart

                     var width = (w-wPadding)/30;

                     var rects = svg.selectAll("rect")
                                    .data(data2)
                                    .enter()
                                    .append("rect")
                                    .attr("x", function(d) {
                                        return (xScale(d.datetime));
                                    })
                                    .attr("y", function(d) {
                                        if(d.tesla_hype <= 0) {
                                            return (h-hPadding);
                                        } else {
                                            return yScale2(d.tesla_hype);
                                        }
                                    })
                                    .attr("height", function(d) {
                                        if(d.tesla_hype <= 0) {
                                            return 10;
                                        } else {
                                            return (h-hPadding)-yScale2(d.tesla_hype);
                                        }
                                    })
                                    .attr("width", function(d) {
                                        return width*0.6;
                                    })
                                    .on("mouseover", function() {
                                        d3.select(this).style("fill", "#fed98e");
                                        updateBarInfo(0, d3.select(this).data()[0]);
                                    })
                                    .on("mouseout", function() {
                                        d3.select(this).style("fill", "#fff7bc");
                                        svg2.selectAll("*").remove();
                                    });

                     rects.each(function(d) {
                         var data_arr = [[],[],[],[],[],[],[],[],[]]; //double array, 0=tsla, then Zoom, Amazon, DAL, Google, NFLX, NVS, PFE, Trip and within each array is the financial data price array for that day
                         var hype_arr = [[],[],[],[],[],[],[],[],[]]; //double array, 0=tsla, then Zoom, Amazon, DAL, Google, NFLX, NVS, PFE, Trip and within each array is the financial data price array for that day
                         var year = d.datetime.getYear();
                         var month = d.datetime.getMonth();
                         var day = d.datetime.getDate();
                         data.forEach(function(d) {
                             if(d.datetime.getYear() == year && d.datetime.getMonth() == month && d.datetime.getDate() == day) {
                                 data_arr[0].push(d.TSLA_price);
                                 data_arr[1].push(d.ZM_price);
                                 data_arr[2].push(d.AMZN_price);
                                 data_arr[3].push(d.DAL_price);
                                 data_arr[4].push(d.GOOGL_price);
                                 data_arr[5].push(d.NFLX_price);
                                 data_arr[6].push(d.NVS_price);
                                 data_arr[7].push(d.PFE_price);
                                 data_arr[8].push(d.TRIP_price);
                             }
                         });
                         data2.forEach(function(d) {
                             if(d.datetime.getYear() == year && d.datetime.getMonth() == month && d.datetime.getDate() == day) {
                                 hype_arr[0].push(d.tesla_hype);
                                 hype_arr[1].push(d.zoom_hype);
                                 hype_arr[2].push(d.amazon_hype);
                                 hype_arr[3].push(d.delta_hype);
                                 hype_arr[4].push(d.google_hype);
                                 hype_arr[5].push(d.netflix_hype);
                                 hype_arr[6].push(d.novartis_hype);
                                 hype_arr[7].push(d.pfizer_hype);
                                 hype_arr[8].push(d.tripadvisor_hype);
                             }
                         })
                         d3.select(this).data()[0].fin_data = data_arr;
                         d3.select(this).data()[0].hype_data = hype_arr;
                     });

                     rects.each(function(d) {
                        fin_data = d3.select(this).data()[0].fin_data;
                        max_price = [];
                        percent_changes=[];
                        for(var i = 0; i < fin_data.length; i++) {
                            max_price.push(d3.max(fin_data[i]));
                            percent_changes.push((fin_data[i][fin_data[i].length-1] - fin_data[i][0])/fin_data[i][0]);
                        }

                        //initial rect data set to Tesla
                        d3.select(this).data()[0].max_price = max_price;
                        d3.select(this).data()[0].percent_changes = percent_changes;

                     });
                    svg.append("g")
                       .attr("class", "x axis")
                       .attr("transform", "translate(0," + (h-hPadding) + ")")
                       .call(xAxis);

                    svg.append("g")
                       .attr("class", "y axis")
                       .attr("transform", "translate(" + wPadding*2 + ",0)")
                       .call(yAxis);

                    svg.append("g")
                       .attr("class", "y axis2")
                       .attr("transform", "translate(" + (w - wPadding*4) + ",0)")
                       .call(yAxis2);


                    svg.append("g")
                       .attr("transform", "translate(" + (wPadding+25) + "," + h/2 + " )")
                       .append("text")
                       .attr("text-anchor", "middle")
                       .attr("transform", "rotate(-90)")
                       .text("Price");


                    svg.append("g")
                       .attr("transform", "translate(" + (w-wPadding*3-25) + "," + h/2 + " )")
                       .append("text")
                       .attr("text-anchor", "middle")
                       .attr("transform", "rotate(90)")
                       .text("Hype");

                    svg.append("text")
                       .attr("x", (w/2-wPadding))
                       .attr("y", h)
                       .text("Date");

                    var line = d3.line()
                                 .defined(function(d) { return d.TSLA_price >= 0; })
                                 .x(function(d) {return xScale(d.datetime)})
                                 .y(function(d) {return yScale(d.TSLA_price)});

                    var path = svg.append("g")

                    path.append("path")
                        .datum(data)
                        .attr("class", "line")
                        .attr("d", line)
                        .style("stroke", '#a6611a');

                    svg.selectAll(".dot")
                       .data(circles)
                       .enter()
                       .append("circle")
                       .attr("class","dot")
                       .attr("cx", function(d) {return xScale(d.datetime)})
                       .attr("cy", function(d) {return yScale(d.TSLA_price)})
                       .attr("r", "3px")
                       .style("fill", '#a6611a')
                       .on("mouseover", function() {
                           d3.select(this)
                             .attr("r", "5px");
                             updateInfo(0, d3.select(this).data()[0]);
                         })
                       .on("mouseout", function() {
                           d3.select(this)
                             .attr("r", "3px");
                           svg2.selectAll("*").remove();
                           rects.each(function(d) {
                               if (d.on == true) {
                                   d.on == false;
                               }
                              d3.select(this).style("fill", "#fff7bc");
                           })
                         });

                    var updateChart = function(index) {
                        rects.on("mouseover", null);
                        rects.on("mouseover", function() {
                            d3.select(this).style("fill", "#fed98e");
                            updateBarInfo(index, d3.select(this).data()[0]);
                        })

                        if(index == 0) {
                            min = d3.min(data, function(d) {return d.TSLA_price})
                            max = d3.max(data, function(d) {return d.TSLA_price})
                            min2 = d3.min(data2, function(d) {return d.tesla_hype})
                            max2 = d3.max(data2, function(d) {return d.tesla_hype})
                            line = d3.line()
                                     .defined(function(d) { return d.TSLA_price >= 0; })
                                     .x(function(d) {return xScale(d.datetime)})
                                     .y(function(d) {return yScale(d.TSLA_price)});
                        } else if (index == 1) {
                            min = d3.min(data, function(d) {return d.ZM_price})
                            max = d3.max(data, function(d) {return d.ZM_price})
                            min2 = d3.min(data2, function(d) {return d.zm_hype})
                            max2 = d3.max(data2, function(d) {return d.zm_hype})
                            line = d3.line()
                                     .defined(function(d) { return d.ZM_price >= 0; })
                                     .x(function(d) {return xScale(d.datetime)})
                                     .y(function(d) {return yScale(d.ZM_price)});
                        } else if (index == 2) {
                            min = d3.min(data, function(d) {return d.AMZN_price})
                            max = d3.max(data, function(d) {return d.AMZN_price})
                            min2 = d3.min(data2, function(d) {return d.amazon_hype})
                            max2 = d3.max(data2, function(d) {return d.amazon_hype})
                            line = d3.line()
                                     .defined(function(d) { return d.AMZN_price >= 0; })
                                     .x(function(d) {return xScale(d.datetime)})
                                     .y(function(d) {return yScale(d.AMZN_price)});
                        } else if (index == 3) {
                            min = d3.min(data, function(d) {return d.DAL_price})
                            max = d3.max(data, function(d) {return d.DAL_price})
                            min2 = d3.min(data2, function(d) {return d.delta_hype})
                            max2 = d3.max(data2, function(d) {return d.delta_hype})
                            line = d3.line()
                                     .defined(function(d) { return d.DAL_price >= 0; })
                                     .x(function(d) {return xScale(d.datetime)})
                                     .y(function(d) {return yScale(d.DAL_price)});
                        } else if (index == 4) {
                            min = d3.min(data, function(d) {return d.GOOGL_price})
                            max = d3.max(data, function(d) {return d.GOOGL_price})
                            min2 = d3.min(data2, function(d) {return d.google_hype})
                            max2 = d3.max(data2, function(d) {return d.google_hype})
                            line = d3.line()
                                     .defined(function(d) { return d.GOOGL_price >= 0; })
                                     .x(function(d) {return xScale(d.datetime)})
                                     .y(function(d) {return yScale(d.GOOGL_price)});
                        } else if (index == 5) {
                            min = d3.min(data, function(d) {return d.NFLX_price})
                            max = d3.max(data, function(d) {return d.NFLX_price})
                            min2 = d3.min(data2, function(d) {return d.netflix_hype})
                            max2 = d3.max(data2, function(d) {return d.netflix_hype})
                            line = d3.line()
                                     .defined(function(d) { return d.NFLX_price >= 0; })
                                     .x(function(d) {return xScale(d.datetime)})
                                     .y(function(d) {return yScale(d.NFLX_price)});
                        } else if (index == 6) {
                            min = d3.min(data, function(d) {return d.NVS_price})
                            max = d3.max(data, function(d) {return d.NVS_price})
                            min2 = d3.min(data2, function(d) {return d.novartis_hype})
                            max2 = d3.max(data2, function(d) {return d.novartis_hype})
                            line = d3.line()
                                     .defined(function(d) { return d.NVS_price >= 0; })
                                     .x(function(d) {return xScale(d.datetime)})
                                     .y(function(d) {return yScale(d.NVS_price)});
                        } else if (index == 7) {
                            min = d3.min(data, function(d) {return d.PFE_price})
                            max = d3.max(data, function(d) {return d.PFE_price})
                            min2 = d3.min(data2, function(d) {return d.pfizer_hype})
                            max2 = d3.max(data2, function(d) {return d.pfizer_hype})
                            line = d3.line()
                                     .defined(function(d) { return d.PFE_price >= 0; })
                                     .x(function(d) {return xScale(d.datetime)})
                                     .y(function(d) {return yScale(d.PFE_price)});
                        } else {
                            min = d3.min(data, function(d) {return d.TRIP_price})
                            max = d3.max(data, function(d) {return d.TRIP_price})
                            min2 = d3.min(data2, function(d) {return d.tripadvisor_hype})
                            max2 = d3.max(data2, function(d) {return d.tripadvisor_hype})
                            line = d3.line()
                                     .defined(function(d) { return d.TRIP_price >= 0; })
                                     .x(function(d) {return xScale(d.datetime)})
                                     .y(function(d) {return yScale(d.TRIP_price)});
                        }

                        yScale.domain([min*0.95,(max*1.05)]);
                        yScale2.domain([0,max2*1.05]);


                        svg.select(".y.axis")
                        .transition()
                        .duration(500)
                        .call(yAxis);


                        svg.select(".y.axis2")
                        .transition()
                        .duration(500)
                        .call(yAxis2);

                        svg.select(".line")
                           .datum(data)
                           .transition()
                           .duration(500)
                           .attr("d", line);


                         //Changing the line
                        if(index == 0) {
                            svg.selectAll(".dot")
                               .transition()
                               .duration(500)
                               .attr("cx", function(d) {return xScale(d.datetime)})
                               .attr("cy", function(d) {return yScale(d.TSLA_price)});
                           svg.selectAll(".dot")
                              .on("mouseover", function() {
                                   d3.select(this)
                                     .attr("r", "5px");
                                     updateInfo(0, d3.select(this).data()[0]);
                                 });
                            rects.data(data2)
                                 .transition()
                                 .duration(500)
                                 .attr("x", function(d) {
                                     return (xScale(d.datetime));
                                 })
                                 .attr("y", function(d) {
                                     if(d.tesla_hype <= 0) {
                                         return (h-hPadding);
                                     } else {
                                         return yScale2(d.tesla_hype);
                                     }
                                 })
                                 .attr("height", function(d) {
                                     if(d.tesla_hype <= 0) {
                                         return 10;
                                     } else {
                                         return (h-hPadding)-yScale2(d.tesla_hype);
                                     }
                                 })
                                 .attr("width", function(d) {
                                     return width*0.6;
                                 })
                        } else if (index == 1) {
                            svg.selectAll(".dot")
                               .transition()
                               .duration(500)
                               .attr("cx", function(d) {return xScale(d.datetime)})
                               .attr("cy", function(d) {return yScale(d.ZM_price)});
                            svg.selectAll(".dot")
                               .on("mouseover", function() {
                                   d3.select(this)
                                     .attr("r", "5px");
                                     updateInfo(1, d3.select(this).data()[0]);
                                 });

                             rects.data(data2)
                                  .transition()
                                  .duration(500)
                                  .attr("x", function(d) {
                                      return (xScale(d.datetime));
                                  })
                                  .attr("y", function(d) {
                                      if(d.zm_hype <= 0) {
                                          return (h-hPadding);
                                      } else {
                                          return yScale2(d.zm_hype);
                                      }
                                  })
                                  .attr("height", function(d) {
                                      if(d.zm_hype <= 0) {
                                          return 10;
                                      } else {
                                          return (h-hPadding)-yScale2(d.zm_hype);
                                      }
                                  })
                                  .attr("width", function(d) {
                                      return width*0.6;
                                  })
                        } else if (index == 2) {
                            svg.selectAll(".dot")
                               .transition()
                               .duration(500)
                               .attr("cx", function(d) {return xScale(d.datetime)})
                               .attr("cy", function(d) {return yScale(d.AMZN_price)});
                            svg.selectAll(".dot")
                               .on("mouseover", function() {
                                   d3.select(this)
                                     .attr("r", "5px");
                                     updateInfo(2, d3.select(this).data()[0]);
                                 });

                             rects.data(data2)
                                  .transition()
                                  .duration(500)
                                  .attr("x", function(d) {
                                      return (xScale(d.datetime));
                                  })
                                  .attr("y", function(d) {
                                      if(d.amazon_hype <= 0) {
                                          return (h-hPadding);
                                      } else {
                                          return yScale2(d.amazon_hype);
                                      }
                                  })
                                  .attr("height", function(d) {
                                      if(d.amazon_hype <= 0) {
                                          return 10;
                                      } else {
                                          return (h-hPadding)-yScale2(d.amazon_hype);
                                      }
                                  })
                                  .attr("width", function(d) {
                                      return width*0.6;
                                  })
                        } else if (index == 3) {
                            svg.selectAll(".dot")
                               .transition()
                               .duration(500)
                               .attr("cx", function(d) {return xScale(d.datetime)})
                               .attr("cy", function(d) {return yScale(d.DAL_price)});
                            svg.selectAll(".dot")
                               .on("mouseover", function() {
                                   d3.select(this)
                                     .attr("r", "5px");
                                     updateInfo(3, d3.select(this).data()[0]);
                                 });

                             rects.data(data2)
                                  .transition()
                                  .duration(500)
                                  .attr("x", function(d) {
                                      return (xScale(d.datetime));
                                  })
                                  .attr("y", function(d) {
                                      if(d.delta_hype <= 0) {
                                          return (h-hPadding);
                                      } else {
                                          return yScale2(d.delta_hype);
                                      }
                                  })
                                  .attr("height", function(d) {
                                      if(d.delta_hype <= 0) {
                                          return 10;
                                      } else {
                                          return (h-hPadding)-yScale2(d.delta_hype);
                                      }
                                  })
                                  .attr("width", function(d) {
                                      return width*0.6;
                                  })
                        } else if (index == 4) {
                            svg.selectAll(".dot")
                               .transition()
                               .duration(500)
                               .attr("cx", function(d) {return xScale(d.datetime)})
                               .attr("cy", function(d) {return yScale(d.GOOGL_price)});
                            svg.selectAll(".dot")
                               .on("mouseover", function() {
                                   d3.select(this)
                                     .attr("r", "5px");
                                     updateInfo(4, d3.select(this).data()[0]);
                                 });

                             rects.data(data2)
                                  .transition()
                                  .duration(500)
                                  .attr("x", function(d) {
                                      return (xScale(d.datetime));
                                  })
                                  .attr("y", function(d) {
                                      if(d.google_hype <= 0) {
                                          return (h-hPadding);
                                      } else {
                                          return yScale2(d.google_hype);
                                      }
                                  })
                                  .attr("height", function(d) {
                                      if(d.google_hype <= 0) {
                                          return 10;
                                      } else {
                                          return (h-hPadding)-yScale2(d.google_hype);
                                      }
                                  })
                                  .attr("width", function(d) {
                                      return width*0.6;
                                  })
                        } else if (index == 5) {
                            svg.selectAll(".dot")
                               .transition()
                               .duration(500)
                               .attr("cx", function(d) {return xScale(d.datetime)})
                               .attr("cy", function(d) {return yScale(d.NFLX_price)});
                            svg.selectAll(".dot")
                               .on("mouseover", function() {
                                   d3.select(this)
                                     .attr("r", "5px");
                                     updateInfo(5, d3.select(this).data()[0]);
                                 });

                             rects.data(data2)
                                  .transition()
                                  .duration(500)
                                  .attr("x", function(d) {
                                      return (xScale(d.datetime));
                                  })
                                  .attr("y", function(d) {
                                      if(d.netflix_hype <= 0) {
                                          return (h-hPadding);
                                      } else {
                                          return yScale2(d.netflix_hype);
                                      }
                                  })
                                  .attr("height", function(d) {
                                      if(d.netflix_hype <= 0) {
                                          return 10;
                                      } else {
                                          return (h-hPadding)-yScale2(d.netflix_hype);
                                      }
                                  })
                                  .attr("width", function(d) {
                                      return width*0.6;
                                  })
                        } else if (index == 6) {
                            svg.selectAll(".dot")
                               .transition()
                               .duration(500)
                               .attr("cx", function(d) {return xScale(d.datetime)})
                               .attr("cy", function(d) {return yScale(d.NVS_price)});
                            svg.selectAll(".dot")
                               .on("mouseover", function() {
                                   d3.select(this)
                                     .attr("r", "5px");
                                     updateInfo(6, d3.select(this).data()[0]);
                                 });

                             rects.data(data2)
                                  .transition()
                                  .duration(500)
                                  .attr("x", function(d) {
                                      return (xScale(d.datetime));
                                  })
                                  .attr("y", function(d) {
                                      if(d.novartis_hype <= 0) {
                                          return (h-hPadding);
                                      } else {
                                          return yScale2(d.novartis_hype);
                                      }
                                  })
                                  .attr("height", function(d) {
                                      if(d.novartis_hype <= 0) {
                                          return 10;
                                      } else {
                                          return (h-hPadding)-yScale2(d.novartis_hype);
                                      }
                                  })
                                  .attr("width", function(d) {
                                      return width*0.6;
                                  })
                        } else if (index == 7) {
                            svg.selectAll(".dot")
                               .transition()
                               .duration(500)
                               .attr("cx", function(d) {return xScale(d.datetime)})
                               .attr("cy", function(d) {return yScale(d.PFE_price)});
                            svg.selectAll(".dot")
                               .on("mouseover", function() {
                                   d3.select(this)
                                     .attr("r", "5px");
                                     updateInfo(7, d3.select(this).data()[0]);
                                 });

                             rects.data(data2)
                                  .transition()
                                  .duration(500)
                                  .attr("x", function(d) {
                                      return (xScale(d.datetime));
                                  })
                                  .attr("y", function(d) {
                                      if(d.pfizer_hype <= 0) {
                                          return (h-hPadding);
                                      } else {
                                          return yScale2(d.pfizer_hype);
                                      }
                                  })
                                  .attr("height", function(d) {
                                      if(d.pfizer_hype <= 0) {
                                          return 10;
                                      } else {
                                          return (h-hPadding)-yScale2(d.pfizer_hype);
                                      }
                                  })
                                  .attr("width", function(d) {
                                      return width*0.6;
                                  })
                        } else {
                            svg.selectAll(".dot")
                               .transition()
                               .duration(500)
                               .attr("cx", function(d) {return xScale(d.datetime)})
                               .attr("cy", function(d) {return yScale(d.TRIP_price)});
                            svg.selectAll(".dot")
                               .on("mouseover", function() {
                                   d3.select(this)
                                     .attr("r", "5px");
                                     updateInfo(8, d3.select(this).data()[0]);
                                 });

                             rects.data(data2)
                                  .transition()
                                  .duration(500)
                                  .attr("x", function(d) {
                                      return (xScale(d.datetime));
                                  })
                                  .attr("y", function(d) {
                                      if(d.tripadvisor_hype <= 0) {
                                          return (h-hPadding);
                                      } else {
                                          return yScale2(d.tripadvisor_hype);
                                      }
                                  })
                                  .attr("height", function(d) {
                                      if(d.tripadvisor_hype <= 0) {
                                          return 10;
                                      } else {
                                          return (h-hPadding)-yScale2(d.tripadvisor_hype);
                                      }
                                  })
                                  .attr("width", function(d) {
                                      return width*0.6;
                                  })
                        }
                    }


                    //For separate SVG
                    var updateInfo = function(index, val) {
                        var day = val.datetime.getDate();
                        var month = val.datetime.getMonth();
                        var max_price;
                        var percent_change;
                        rects.each(function(d,i) {
                            if(d.datetime.getMonth() == month && d.datetime.getDate() == day) {
                                d3.select(this).style("fill", "#fed98e").attr("on", true)
                                max_price = Math.round(d3.select(this).data()[0].max_price[index]*100)/100;
                                percent_change = Math.round(d3.select(this).data()[0].percent_changes[index]*10000)/100;
                            }
                        })

                        svg2.append("text")
                            .attr("x", 2)
                            .attr("y", 15)
                            .attr("font-size", 16)
                            .text(function() {
                                return "Time: " + val.datetime;
                            });

                        svg2.append("text")
                            .attr("x", 2)
                            .attr("y", 30)
                            .attr("font-size", 16)
                            .text(function() {
                                if (index == 0) {
                                    var temp = (Math.round(val.TSLA_price*100))/100;
                                    return "TSLA price: $" + temp.toFixed(2);
                                } else if (index == 1) {
                                    var temp = (Math.round(val.ZM_price*100))/100
                                    return "ZM price: $" + temp.toFixed(2);
                                } else if (index == 2) {
                                    var temp = (Math.round(val.AMZN_price*100))/100
                                    return "AMZN price: $" + temp.toFixed(2);
                                } else if (index == 3){
                                    var temp = (Math.round(val.DAL_price*100))/100
                                    return "DAL price: $" + temp.toFixed(2);
                                } else if (index == 4){
                                    var temp = (Math.round(val.GOOGL_price*100))/100
                                    return "GOOGL price: $" + temp.toFixed(2);
                                } else if (index == 5){
                                    var temp = (Math.round(val.NFLX_price*100))/100
                                    return "NFLX price: $" + temp.toFixed(2);
                                } else if (index == 6){
                                    var temp = (Math.round(val.NVS_price*100))/100
                                    return "NVS price: $" + temp.toFixed(2);
                                } else if (index == 7){
                                    var temp = (Math.round(val.PFE_price*100))/100
                                    return "PFE price: $" + temp.toFixed(2);
                                } else {
                                    var temp = (Math.round(val.TRIP_price*100))/100
                                    return "TRIP price: $" + temp.toFixed(2);
                                }
                            });


                        svg2.append("text")
                            .attr("x", 2)
                            .attr("y", 45)
                            .attr("font-size", 16)
                            .text(function() {
                                if (max_price == undefined || isNaN(max_price)) {
                                    return "Day's High: Weekend, or no data";
                                }
                                return "Day's High: $" + max_price;
                            });
                        svg2.append("text")
                            .attr("x", 2)
                            .attr("y", 60)
                            .attr("font-size", 16)
                            .text(function() {
                                if (percent_change == undefined || isNaN(percent_change)) {
                                    return "Daily Percentage Change: Weekend, or no data";
                                }
                                return "Daily Percentage Change: " + percent_change +"%";
                            });
                    }

                    var updateBarInfo = function(index, obj) {
                        var date = obj.datetime;
                        var hype = obj.hype_data[index][0];
                        var max_price = Math.round(obj.max_price[index] * 100)/100;
                        var percent_change = Math.round(obj.percent_changes[index]*10000)/100;
                        svg2.append("text")
                            .attr("x", 2)
                            .attr("y", 15)
                            .attr("font-size", 16)
                            .text(function() {
                                return "Day: " + date;
                            });
                        svg2.append("text")
                            .attr("x", 2)
                            .attr("y", 30)
                            .attr("font-size", 16)
                            .text(function() {
                                return "Hype: " + Math.round(hype*100)/100;
                            });
                        svg2.append("text")
                            .attr("x", 2)
                            .attr("y", 45)
                            .attr("font-size", 16)
                            .text(function() {
                                if (max_price == undefined || isNaN(max_price)) {
                                    return "Day's High: Weekend, or no data";
                                }
                                return "Day's High: $" + max_price;
                            });
                        svg2.append("text")
                            .attr("x", 2)
                            .attr("y", 60)
                            .attr("font-size", 16)
                            .text(function() {
                                if (percent_change == undefined || isNaN(percent_change)) {
                                    return "Daily Percentage Change: Weekend, or no data";
                                }
                                return "Daily Percentage Change: " + percent_change +"%";
                            });
                    }
                })
            })

        </script>
    </body>
</html>
